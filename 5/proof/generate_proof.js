
/*
https://poseidon-online.pages.dev/
r
   1       2
 x   y   z   w
1 2 3 4 5 6 7 8


xyzw:
7853200120776062878684798364095072458815029376092732009249414926327459813530
14763215145315200506921711489642608356394854266165572616578112107564877678998
1879402270149794212432036740081454186623842057661213288749068713224962094903
19419916100242727769718322657520778503680617689214632373938093157277816551712

12:
3330844108758711782672220159612173083623710937399719017074673646455206473965
14693904821945502268578313651525098196765636411922213115469821563817117273617

4,x,2:
4,7853200120776062878684798364095072458815029376092732009249414926327459813530n,14693904821945502268578313651525098196765636411922213115469821563817117273617n

7,z,1:
7,
1879402270149794212432036740081454186623842057661213288749068713224962094903n,
3330844108758711782672220159612173083623710937399719017074673646455206473965n

1,y,2
1,14763215145315200506921711489642608356394854266165572616578112107564877678998n,14693904821945502268578313651525098196765636411922213115469821563817117273617n,

r:
14629452129687363793084585378194807561782241384488665279773588974567494940279

*/
//example command: `node gen_proof.js 1 2 3 4 5 6`
(async () => {
    const snarkjs = require('snarkjs');
    const fs = require('fs');

    const last_index = process.argv.length - 1;

    const proofInput = {
        vote: 5,
        s: 345,
        k: 357,
        entry_index: 2,
        merkle_leafs: [
            7020003394394666990960673981134349377535980189597271278044812177123909403151n,
            14773286974096855589808739694181791015827463825449008199871790464929355935269n,
            12926273887286769764467998999544163914307559922216585524378099580891955033415n
        ],
        previous_vote: 0
    };
    const {proof, publicSignals} = await snarkjs.groth16.fullProve(
        proofInput,
        'circuit_js/circuit.wasm',
        'circuit_prover.zkey'
    );

    console.log('Proof: ', proof);
    console.log('Public Signals: ', publicSignals);

    const vKey = JSON.parse(fs.readFileSync('circuit_verifier.json'));
    const res = await snarkjs.groth16.verify(vKey, publicSignals, proof);
    if(res){
        //console.log(proof);
        process.exit(0);
    }
    else{
        console.log("FAILED TO VERIFY THE PROOF!!!!!");
        process.exit(1);
    }
})();